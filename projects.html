<!doctype html>
<html lang="ko">
<head>
 <meta charset="utf-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>CPL ì‘í’ˆ ì „ì‹œ</title>
 <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600&display=swap" rel="stylesheet">
 <style>
  /* 1. ê¸°ë³¸ ë°ì€ í…Œë§ˆ (ê°ˆìƒ‰) ì •ì˜ */
  :root {
   --primary-color: #A0522D; /* ê°ˆìƒ‰ */
   --primary-hover: #8B4513; /* ì§„í•œ ê°ˆìƒ‰ */
   --text-color: #333;
   --bg-color: #fff;
   --card-bg: #fdfdfd;
   --tab-bg: #f0f0f0;
   --header-bg: #fff;
   --card-border: #eee;
  }

  /* 2. ì–´ë‘ìš´ í…Œë§ˆ í´ë˜ìŠ¤ ì •ì˜ */
  .dark-mode {
   --primary-color: #6ee7b7; /* ë¯¼íŠ¸ìƒ‰ */
   --primary-hover: #37c793;
   --text-color: #e6eef6;
   --bg-color: #0f172a; /* ì§™ì€ íŒŒë‘ */
   --card-bg: rgba(255, 255, 255, 0.05);
   --tab-bg: rgba(255, 255, 200, 0.1);
   --header-bg: #0f172a;
   --card-border: rgba(255, 255, 255, 0.1);
  }

  body {
   font-family: 'Noto Sans KR', sans-serif;
   margin: 0; 
   background: var(--bg-color); /* ë°°ê²½ìƒ‰ ë³€ìˆ˜ ì‚¬ìš© */
   color: var(--text-color); /* í…ìŠ¤íŠ¸ìƒ‰ ë³€ìˆ˜ ì‚¬ìš© */
   transition: background 0.3s, color 0.3s;
  }
  header {
   text-align: center; 
   padding: 1.5rem 1rem;
   border-bottom: 1px solid var(--card-border); 
   position: relative;
   background: var(--header-bg); /* í—¤ë” ë°°ê²½ìƒ‰ ë³€ìˆ˜ ì‚¬ìš© */
  } 
  h1 {
   margin: 0;
  }
  /* ëª¨ë“œ ë°”ê¾¸ê¸° ë²„íŠ¼ ìŠ¤íƒ€ì¼ (Headerì— ìˆìŒ) */
  #themeToggle {
   transition: background 0.3s, color 0.3s;
  }
  .back-btn {
   position: absolute; 
   left: 20px; 
   top: 50%;
   transform: translateY(-50%);
   padding: 0.5rem 1rem; 
   background: var(--primary-color); 
   color: var(--bg-color); 
   border-radius: 8px; 
   font-weight: 600; 
   text-decoration: none;
   transition: 0.2s;
  }
  .back-btn:hover {
   background: var(--primary-hover); 
  }
  .tabs {
   display: flex; 
   justify-content: center; 
   gap: 12px; 
   margin: 20px 0;
  }
  .tab {
   padding: 8px 18px; 
   border-radius: 12px; 
   background: var(--tab-bg); 
   color: var(--text-color);
   cursor: pointer;
   transition: 0.2s;
  }
  .tab.active {
   background: var(--primary-color); 
   color: var(--bg-color); 
   font-weight: 600;
  }
  .search-box {
   text-align: center; 
   margin-bottom: 20px;
  }
  input {
   padding: 10px; 
   width: 240px; 
   border-radius: 8px; 
   border: 1px solid #ddd; 
   background: var(--tab-bg); 
   color: var(--text-color);
   outline: none;
  }
  .grid {
   display: grid; 
   grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); 
   gap: 16px; 
   padding: 20px;
  }
  .card {
   background: var(--card-bg); 
   border: 1px solid var(--card-border); 
   border-radius: 12px; 
   padding: 16px; 
   cursor: pointer; 
   transition: transform 0.2s, box-shadow 0.2s;
  }
  .card:hover {
   transform: translateY(-3px);
   box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  .thumb {
   position: relative;
   padding-top: 56.25%; /* 16:9 ë¹„ìœ¨ ìœ ì§€ */
   border-radius: 10px; 
   background: var(--tab-bg); 
   display: flex; 
   align-items: center; 
   justify-content: center; 
   color: var(--text-color);
  }
  .thumb img {
   position: absolute;
   top: 0;
   left: 0;
   width: 100%;
   height: 100%;
   object-fit: cover; 
   border-radius: 10px;
  }
  .modal-bg {
   position: fixed; 
   inset: 0; 
   background: rgba(0, 0, 0, 0.4); 
   display: flex; 
   align-items: center; 
   justify-content: center;
   z-index: 1000;
  }
  .modal {
   background: var(--bg-color); 
   padding: 25px; 
   border-radius: 12px; 
   max-width: 750px; /* ëª¨ë‹¬ ë„ˆë¹„ í™•ì¥ */
   width: 90%;
   box-shadow: 0 5px 15px rgba(0,0,0,0.3);
   text-align: left;
  }
  
  /* â˜… ëª¨ë‹¬ ë‚´ë¶€ ë ˆì´ì•„ì›ƒì„ ìœ„í•œ Flexbox ì»¨í…Œì´ë„ˆ */
  .modal-content-wrapper {
      display: flex;
      gap: 25px; /* ì´ë¯¸ì§€ì™€ ì½˜í…ì¸  ì‚¬ì´ ê°„ê²© */
  }
  
  /* â˜… ëª¨ë‹¬ ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ (ì™¼ìª½) */
  .modal-image-area {
      flex: 1; /* ê°€ìš© ê³µê°„ì˜ ì ˆë°˜ */
      min-width: 40%;
  }

  /* â˜… ëª¨ë‹¬ í…ìŠ¤íŠ¸ ì½˜í…ì¸  ì»¨í…Œì´ë„ˆ (ì˜¤ë¥¸ìª½) */
  .modal-text-area {
      flex: 1; /* ê°€ìš© ê³µê°„ì˜ ì ˆë°˜ */
      min-width: 40%;
  }

  /* ëª¨ë‹¬ ì´ë¯¸ì§€ ìŠ¤íƒ€ì¼ */
  .modal-img {
      max-width: 100%; 
      height: auto; 
      border-radius: 8px; 
      margin-bottom: 15px; 
      display: block; 
  }

  .close {
   float: right; 
   cursor: pointer; 
   color: #999; 
   font-size: 1.2rem;
  }
  .btn {
   padding: 10px 20px; 
   border: none; 
   border-radius: 8px; 
   background: var(--primary-color); 
   color: var(--bg-color); 
   cursor: pointer; 
   font-weight: 600;
   transition: 0.2s;
   display: block;
   width: 100%;
  }
  .btn:hover {
   background: var(--primary-hover); 
  }
 </style>
</head>
<body>
 <header>
  <a href="index.html" class="back-btn">â† ë©”ì¸ìœ¼ë¡œ</a>
  <h1>CPL ì‘í’ˆ ì „ì‹œ</h1>
  <button id="themeToggle" style="position: absolute; right: 20px; top: 50%; transform: translateY(-50%); padding: 0.5rem 1rem; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
    ğŸŒ— ëª¨ë“œ ë°”ê¾¸ê¸°
  </button>
 </header>
 <div class="tabs">
  <div class="tab active" data-type="all">ì „ì²´</div>
  <div class="tab" data-type="game">ê²Œì„</div>
  <div class="tab" data-type="web">ì›¹</div>
 </div>
 <div class="search-box">
  <input type="text" id="search" placeholder="í•™ë²ˆ, ì´ë¦„ ë˜ëŠ” ì œëª© ê²€ìƒ‰">
 </div>
 <div class="grid" id="grid"></div>

 <template id="modalTemplate">
  <div class="modal-bg">
   <div class="modal">
    <span class="close">âœ•</span>
    
    <div class="modal-content-wrapper">
        <div class="modal-image-area">
             <img id="m-poster" src="" alt="ì‘í’ˆ í¬ìŠ¤í„°" class="modal-img" style="display:none;">
        </div>

        <div class="modal-text-area">
            <h2 id="m-title"></h2>
            <p style="color:#666; font-size:0.9rem;" id="m-creators"></p>
            <p style="margin-top:1rem;" id="m-desc"></p>
            <div style="text-align:center; margin-top:20px;">
                <button class="btn" id="m-action"></button>
            </div>
        </div>
    </div>
   </div>
  </div>
 </template>

 <script>
  let allProjects = [];
  let currentTab = 'all';
  const STORAGE_KEY = 'cplThemeMode';

  async function loadProjects() {
   try {
    // projects.jsonì˜ êµ¬ì¡°ê°€ ë³€ê²½ë˜ì—ˆë‹¤ê³  ê°€ì •í•˜ê³  ë¡œì§ì„ ìˆ˜ì •í•©ë‹ˆë‹¤.
    const res = await fetch('projects.json');
    if (!res.ok) throw new Error('íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
    allProjects = await res.json();
    render();
   } catch (e) {
    console.error(e);
    // alert('projects.json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê°™ì€ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.');
   }
  }

  function render() {
   const grid = document.getElementById('grid');
   const searchVal = document.getElementById('search').value.toLowerCase();
   grid.innerHTML = '';
   const filtered = allProjects.filter(p => {
    const matchesTab = currentTab === 'all' || p.type === currentTab;
    const text = (p.title + p.description + p.type + p.creators.map(c=>c.name+c.id).join('')).toLowerCase();
    const matchesSearch = text.includes(searchVal);
    return matchesTab && matchesSearch;
   });
   filtered.forEach(p => {
    const div = document.createElement('div');
    div.className = 'card';
    
    // p.preview_posterë¥¼ ì‚¬ìš©í•˜ì—¬ ë¯¸ë¦¬ë³´ê¸° ì´ë¯¸ì§€ ì„¤ì •
    const previewSrc = p.preview_poster || p.poster; // preview_posterê°€ ì—†ìœ¼ë©´ ê¸°ì¡´ poster ì‚¬ìš©
    div.innerHTML = `<div class='thumb'>${previewSrc ? `<img src='${previewSrc}' alt='${p.title} ë¯¸ë¦¬ë³´ê¸°'>` : 'í¬ìŠ¤í„° ì—†ìŒ'}</div><h3>${p.title}</h3><p style='color:#777; font-size:0.9rem;'>${p.creators.map(c=>c.name).join(', ')}</p>`;
    div.onclick = () => openModal(p);
    grid.appendChild(div);
   });
  }

  function openModal(p){
   const tpl = document.getElementById('modalTemplate').content.cloneNode(true);
   const bg = tpl.querySelector('.modal-bg');
   const imageArea = tpl.querySelector('.modal-image-area');
   const posterImg = tpl.getElementById('m-poster'); 
   
   // p.posterë¥¼ ì‚¬ìš©í•˜ì—¬ íŒì—… ì´ë¯¸ì§€ ì„¤ì •
   if (p.poster) {
       posterImg.src = p.poster;
       posterImg.style.display = 'block';
       imageArea.style.display = 'block';
   } else {
       // ì´ë¯¸ì§€ê°€ ì—†ìœ¼ë©´ ì´ë¯¸ì§€ ì˜ì—­ ì „ì²´ë¥¼ ìˆ¨ê¸°ê³  í…ìŠ¤íŠ¸ ì˜ì—­ì„ í™•ì¥
       imageArea.style.display = 'none';
       tpl.querySelector('.modal-content-wrapper').style.display = 'block';
       tpl.querySelector('.modal-text-area').style.maxWidth = '100%';
       tpl.querySelector('.modal-text-area').style.width = '100%';
   }

   tpl.getElementById('m-title').textContent = p.title;
   tpl.getElementById('m-creators').textContent = p.creators.map(c => `${c.name} (${c.id})`).join(', ');
   tpl.getElementById('m-desc').textContent = p.description;
   const btn = tpl.getElementById('m-action');
   if(p.type === 'web'){
    btn.textContent = 'ğŸŒ ë§í¬ ë³´ê¸°';
    btn.onclick = () => window.open(p.info,'_blank');
   } else {
    btn.textContent = 'ğŸ® í”Œë ˆì´ ìœ„ì¹˜ ë³´ê¸°';
    btn.onclick = () => alert(p.info);
   }
   tpl.querySelector('.close').onclick = () => bg.remove();
   bg.onclick = e => {if(e.target===bg) bg.remove();};
   document.body.appendChild(bg);
  }

  // **********************************
  // â˜… í…Œë§ˆ ì „í™˜ ê¸°ëŠ¥ (ê¸°ì¡´ ìœ ì§€)
  // **********************************
  const body = document.body;
  const themeToggle = document.getElementById('themeToggle');

  // 1. ì´ˆê¸° í…Œë§ˆ ì„¤ì •
  function setInitialTheme() {
      const savedTheme = localStorage.getItem(STORAGE_KEY) || 'light';
      const isDark = savedTheme === 'dark';
      
      if (isDark) {
          body.classList.add('dark-mode');
      }
      // ë²„íŠ¼ ìƒ‰ìƒ ë° í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (CSS ë³€ìˆ˜ì™€ ë¬´ê´€í•œ ì¸ë¼ì¸ ìŠ¤íƒ€ì¼)
      themeToggle.textContent = isDark ? 'â˜€ï¸ ëª¨ë“œ ë°”ê¾¸ê¸°' : 'ğŸŒ‘ ëª¨ë“œ ë°”ê¾¸ê¸°';
      themeToggle.style.background = isDark ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
      themeToggle.style.color = isDark ? 'var(--text-color)' : 'var(--text-color)';
  }

  // 2. í…Œë§ˆ ì „í™˜ í•¸ë“¤ëŸ¬
  function toggleTheme() {
      body.classList.toggle('dark-mode');
      const newTheme = body.classList.contains('dark-mode') ? 'dark' : 'light';
      localStorage.setItem(STORAGE_KEY, newTheme);
      
      themeToggle.textContent = newTheme === 'dark' ? 'â˜€ï¸ ëª¨ë“œ ë°”ê¾¸ê¸°' : 'ğŸŒ‘ ëª¨ë“œ ë°”ê¾¸ê¸°';
      themeToggle.style.background = newTheme === 'dark' ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';
  }

  // 3. ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì—°ê²° ë° ì´ˆê¸°í™”
  themeToggle.addEventListener('click', toggleTheme);
  setInitialTheme(); 

  document.getElementById('search').addEventListener('input', render);
  document.querySelectorAll('.tab').forEach(tab => {
   tab.onclick = () => {
    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    currentTab = tab.dataset.type;
    render();
   };
  });

  loadProjects();
 </script>
</body>
</html>